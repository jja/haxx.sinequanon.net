<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>haxx qua non - GORM nullables and unsaved transient instance</title>
  <meta name="description" content="tips and tricks from a working coder">
  <link rel="stylesheet" type="text/css" href="/css/site.css" />
</head>
<body>

  <header>
    <h1>
      <a class="header-span plain" rel="home" href="http://haxx.sinequanon.net/">haxx qua non</a>
    </h1>
  </header>

  <article>

      <h1>GORM nullables and unsaved transient instance</h1>

      <section id="meta">

          <div id="byline">
            by jja
            on <time datetime="2011-04-05T12:34:34-0600">2011-04-05</time>
          </div>

          Topics: <ul id="tags">
              <li class="tagitem">
                <a class="tag" href="/tag/gorm">gorm</a>
              </li>
              <li class="tagitem">
                <a class="tag" href="/tag/grails">grails</a>
              </li>
              <li class="tagitem">
                <a class="tag" href="/tag/hibernate">hibernate</a>
              </li>
          </ul>

      </section>

      <section id="post_content">

        <p>I have nullable one-to-many relations in Grails/GORM and started getting
&quot;object references an unsaved transient instance&quot; exceptions from Hibernate.
In the Grails forms, selecting a blank/no-selection value for the field sent
<code>params.myOtherObject.id==''</code>. GORM then tries to create a new empty object
and during the <code>save(flush:true)</code>, it complains with the exception:</p>
<!-- more -->
<pre><code>org.hibernate.TransientObjectException: object references an unsaved
transient instance - save the transient instance before flushing: MyOtherClass
</code></pre>
<p>This
<a href="http://stackoverflow.com/questions/4810574/grails-gorm-object-references-an-unsaved-transient-instance/4833693#4833693">stackoverflow answer</a>
gave me the clue about params and I now remove the nullable field from
<code>params</code> when it's blank.</p>
<pre><code>def myObject = MyClass.get(params.id)
if (null == params.myOtherObject.id || '' == params.myOtherObject.id) {
        myObject.myOtherObject = null
        params.remove('myOtherObject')
        }
myObject.properties = params
if (!myObject.hasErrors() &amp;&amp; myObject.save(flush: true)) {
...
</code></pre>
<h2>Comments</h2>
<p>mamram commented at 2011-07-02 10:04:01</p>
<p>thanks, params.remove() was the trick...</p>


      </section>

  </article>

  <div id="comment-form">
        (comments are closed)
  </div>

  <section id="nav">
        <a class="footer-span plain" href="/2011/03/groovy-grails-markup-builder">Previous: Groovy (Grails) markup builder for select/option menu</a>

        <a class="footer-span plain" href="/2011/06/grails-standalone-classes-need-package">Next: Grails standalone classes need package</a>
  </section>

  <footer>
    <a class="footer-span plain" rel="home" href="http://haxx.sinequanon.net/">Home</a>
  </footer>

</body>
</html>
