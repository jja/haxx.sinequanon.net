<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>haxx populi - Grails stacktrace.log</title>
  <meta name="description" content="tips and tricks from a working coder">
  <link rel="stylesheet" type="text/css" href="/css/site.css" />
</head>
<body>

  <header>
    <h1>
      <a class="header-span plain" rel="home" href="http://haxx.sinequanon.net/">haxx populi</a>
    </h1>
  </header>

  <article>

      <h1>Grails stacktrace.log</h1>

      <section id="meta">

          <div id="byline">
            by jja
            on <time datetime="2008-09-30T17:58:57-0600">2008-09-30</time>
          </div>

          Topics: <ul id="tags">
              <li class="tagitem">
                <a class="tag" href="/tag/grails">grails</a>
              </li>
              <li class="tagitem">
                <a class="tag" href="/tag/logging">logging</a>
              </li>
          </ul>

      </section>

      <section id="post_content">

        <p>Grails 1.0.x started creating a <code>stacktrace.log</code> file in the directory where
the servlet container starts. In a development environment, using
<code>grails run-app</code>, that's simple enough--- it appears in the top level of your
application. In a production environment, this becomes a problem. Your
production container (e.g. Tomcat) may start someplace where it can't create
files, like <code>/</code>. Thus you get exceptions sent to your container's log files
like:</p>
<!-- more -->
<pre><code>java.io.FileNotFoundException: stacktrace.log (Permission denied)
</code></pre>
<p>Also, messages are appended to <code>stacktrace.log</code>-- so it will continue to grow if
you don't do something about it. One option is to change where your container
starts, e.g. have the startup script change to its logs directory. You can
also configure your grails app to change the location of the <code>stacktrace.log</code>
file or turn it off completely.</p>
<h2>Changing file location</h2>
<p>To change the file location/name, edit your <code>grails-app/conf/Config.groovy</code>
file. In Grails 1.0.3, you want to change the line:</p>
<pre><code>appender.'stacktraceLog.File'=&quot;stacktrace.log&quot;
</code></pre>
<p>to something like:</p>
<pre><code>appender.'stacktraceLog.File'=&quot;/var/log/myapp/stacktrace.log&quot;
</code></pre>
<p>In Grails 1.0, 1.0.1, and 1.0.2, the property is:</p>
<pre><code>appender.'errors.File'=&quot;stacktrace.log&quot;
</code></pre>
<h2>Turning off stacktrace.log</h2>
<p>To turn off the log file completely, in 1.0.3 change the line:</p>
<pre><code>StackTrace=&quot;error,stacktraceLog&quot;
</code></pre>
<p>to:</p>
<pre><code>StackTrace=&quot;error&quot;
</code></pre>
<p>In previous versions, the original line is:</p>
<pre><code>StackTrace=&quot;error,errors&quot;
</code></pre>
<p>What we are doing is removing the only appender from the StackTrace logger
(automatically created by Grails) so the messages will not be written anywhere
(and the file will not be created). The word <code>error</code> that remains indicates
the logging level. We could also change it to <code>off</code> to be clear (only doing
that without removing the appender will still result in an attempt to create
the file).</p>
<h2>No stacktrace processing</h2>
<p>According to the
<a href="http://grails.org/doc/1.0.3/guide/3.%20Configuration.html#3.1.2%20Logging">Grails docs</a>,
you can also turn this off by setting a command line property:</p>
<pre><code>grails -Dgrails.full.stacktrace=true run-app
</code></pre>
<p>(yes, true) If you don't also turn off the logging property, the
<code>stacktrace.log</code> file will still be created but won't be written to. Putting
that line in <code>Config.groovy</code> doesn't do anything. It also doesn't help when
creating a war for deployment. You'll have to put that property definition
into your container startup (setting the environment variable <code>CATALINA_OPTS</code>
or adding to your <code>jsvc</code> command line).</p>
<h2>Console logging</h2>
<p>The docs also suggest sending the stacktrace to the console (for Tomcat 5.x
that's <code>$CATALINA_HOME/logs/catalina.out</code>), by changing the <code>stacktraceLog</code> or
<code>errors</code> appender in the above line to <code>stdout</code>, like this:</p>
<pre><code>StackTrace=&quot;error,stdout&quot;
</code></pre>
<p>But error messages seem to go to the console anyways and so
<a href="http://jira.codehaus.org/browse/GRAILS-1695">will be doubled</a>.</p>
<h2>Environments</h2>
<p>You can make these changes for different environments. In <code>Config.groovy</code> add
something like this:</p>
<pre><code>environments {
    production { log4j.logger.StackTrace=&quot;error&quot; }
}
</code></pre>
<p>which will turn off the stacktrace logging file for your production
environment, but leave it on for development.</p>
<h2>Upgrades</h2>
<p>I didn't notice all this until just now with my new grails projects, because
my original Grails projects were created before these shenanigans started
happening. I've done <code>grails upgrade</code> several times since then, but
stacktrace.log configuration
<a href="http://jira.codehaus.org/browse/GRAILS-1636">isn't yet in the upgrade script</a>.</p>
<h2>Grails 1.1 update</h2>
<p>Grails 1.1 introduces a new Log4J DSL that completely changes this. I could
not immediately get the above methods working. There are several undocumented
behaviors that both cause and cure this. Assigning a different appender to the
StrackTrace logger sends the stacktraces to that appender but it does not
prevent the creation of a <code>FileAppender</code> named <code>stacktraceLog</code> and thus the
file <code>stacktrace.log</code> is still created.</p>
<p>Reviewing the code (Log4jConfig.groovy), I found that the stacktraceLog
appender is not created if an appender named <code>stacktrace</code> already exists, i.e.
it's created at the top of the log4j DSL closure. You can create a different
file or rollingFile appender or whatever you like, just use
<code>name:'stacktrace'</code>.</p>
<p>I like to turn off stacktrace logging completely. It's an error, so it's
already going to the root logger anyways. Or I may want to send it to my
appender named something else (like 'tomcatLog', which I use for other loggers
and don't want to call it 'stacktrace'). Use the undocumented NullAppender
which exists in Grails by default. Create an appender of type <code>'null'</code> -- with
quotes to avoid referencing the null object:</p>
<pre><code>log4j = {
  appenders {
    'null' name:'stacktrace'
    ...
  }
...
}
</code></pre>
<h2>Comments</h2>
<p>Ben commented at 2009-10-29 10:31:31</p>
<p>Hi, Thanks for your tip (Grails 1.1 update) it worked for me!</p>
<hr>
<p><a href="http://anders.zakrisson.se/projects/how-to-setup-a-vps-to-run-grails-on-jetty/">How to Setup a VPS to Run Grails on Jetty - Anders Zakrisson</a> commented at 2010-01-05 03:15:36</p>
<p>[...] Jetty on Port 80 Virtual hosts in Jetty Fixing the stacktrace.log Using GNU Screen MySQL Console [...]</p>
<hr>
<p>ew commented at 2012-05-29 09:56:57</p>
<p>this doesnt work</p>
<pre><code>log4j = {
    // Example of changing the log pattern for the default console
    // appender:
    //
    appenders {
    //  console name:'stdout', layout:pattern(conversionPattern: '%c{2} %m%n')
        appender.'stacktraceLog.File'=&quot;/tmp/logs/cms-stacktrace.log&quot;
    }

15:48:31,044 ERROR [stderr] (MSC service thread 1-4) log4j:ERROR Property missing when configuring log4j: appender
15:48:31,060 ERROR [stderr] (MSC service thread 1-4) log4j:ERROR WARNING: Exception occured configuring log4j logging: Cannot set property 'stacktraceLog.File' on null object
</code></pre>
<hr>
<p><a href="http://haxx.sinequanon.net/">jja</a> commented at 2012-06-05 12:10:14</p>
<p>What version of Grails? that syntax came along in 1.1 and still works for me in 1.3.x</p>


      </section>

  </article>

  <div id="comment-form">
        (comments are closed)
  </div>

  <section id="nav">
        <a class="footer-span plain" href="/2008/09/grails-logging">Previous: Grails logging</a>

        <a class="footer-span plain" href="/2008/10/grails-errorgsp-security">Next: Grails error.gsp security</a>
  </section>

  <footer>
    <a class="footer-span plain" rel="home" href="http://haxx.sinequanon.net/">Home</a>
  </footer>

</body>
</html>
