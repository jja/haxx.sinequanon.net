<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>haxx qua non - Spring ScheduledExecutors in Grails</title>
  <meta name="description" content="tips and tricks from a working coder">
  <link rel="stylesheet" type="text/css" href="/css/site.css" />
</head>
<body>

  <header>
    <h1>
      <a class="header-span plain" rel="home" href="http://haxx.sinequanon.net/">haxx qua non</a>
    </h1>
  </header>

  <article>

      <h1>Spring ScheduledExecutors in Grails</h1>

      <section id="meta">

          <div id="byline">
            by jja
            on <time datetime="2016-09-30T17:48:20-0600">2016-09-30</time>
          </div>

          Topics: <ul id="tags">
              <li class="tagitem">
                <a class="tag" href="/tag/grails">grails</a>
              </li>
              <li class="tagitem">
                <a class="tag" href="/tag/spring">spring</a>
              </li>
          </ul>

      </section>

      <section id="post_content">

        <p>Here&#39;s how to setup scheduled (periodic or timed) tasks with Spring3
in Grails using the concurrency executors introduced in Java5.
This replaces the use of a Spring2 <code>TimerTask</code> which was deprecated in
Spring3 and removed from Spring4. Grails2 uses Spring3 so
the <code>TimerTask</code> should still work, but this method should work
in Grails2 and Grails3. Note that in Grails3 and
<a href="https://github.com/grails/grails-core/issues/2216">possibly 2.4/2.5</a>,
you might be able to use the much simpler Spring
<a href="http://docs.spring.io/spring/docs/3.0.x/spring-framework-reference/html/scheduling.html#scheduling-annotation-support-scheduled"><code>@Scheduled</code></a>
annotation on a service method.</p>
<!-- more -->
<p>Thanks to the blog at henyo for the inspiration, with
<a href="http://blog.henyo.com/2008/11/simple-periodic-task-scheduling-with.html">their post</a>
on Spring2 TimerTask usage in Grails1.</p>
<p>In Grails 2.x, add something like this in your
<code>grails-app/conf/spring/resources.groovy</code>
(following/updated from henyo):</p>
<pre><code>myInvoker(org.springframework.scheduling.support.MethodInvokingRunnable) {
    targetObject = ref(&#39;myService&#39;)
    targetMethod = &#39;myMethod&#39;
}

myScheduler(org.springframework.scheduling.concurrent.ScheduledExecutorTask) {
    // in Config.groovy, set mykey.delay and mykey.period
    // milliseconds, 600000ms = 10min
    delay = grailsApplication.config.mykey.delay ?: 600000
    period = grailsApplication.config.mykey.period ?: 600000
    runnable = ref(&#39;myInvoker&#39;)
}

myFactory(org.springframework.scheduling.concurrent.ScheduledExecutorFactoryBean) {
    scheduledExecutorTasks = [ref(&#39;myScheduler&#39;)]
}
</code></pre><p>Then of course you will need a <code>myService</code> class with a <code>myMethod</code> method
that takes no arguments.</p>


      </section>

  </article>

  <div id="comment-form">
        (comments are closed)
  </div>

  <section id="nav">
        <a class="footer-span plain" href="/2016/08/gh-pages-setup">Previous: GitHub pages clone setup</a>

  </section>

  <footer>
    <a class="footer-span plain" rel="home" href="http://haxx.sinequanon.net/">Home</a>
  </footer>

</body>
</html>
